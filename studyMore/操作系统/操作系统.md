

# 操作系统

## 第一章

### 操作系统的基本特性

#### **并发与并行**

并行是指两个或者多个事件在同一时刻发生

并发是指两个或多个事件在同一时间间隔发生，它们并非是真正的同时运行，而是由于进程得切换速度足够的快保证人无法察觉到变化。

- **进程**

  所谓进程，是指在操作系统中能独立运行并作为资源分配的基本单位，他是由一组机器指令，数据和堆栈等组成的，是一个独立运行的活动实体。**多个进程之间可以并发执行和交换信息**。

- **共享**

​       操作系统中的共享与一般情况下的共享不相同，操作系统中的共享被称为资源复用，是指系统中的资源可供内存中多个并发执行的进程共同使用。这里在宏观上既限定了时间(进程在内存期间)，也限定了地点(内存)。对于这种资源共享方式，其管理要复杂很多。因为系统中的资源远小于多道程序需求的总和，会形成他们对共享资源的争夺。所以，操作系统必须对资源进行妥善的管理。

#### **互斥共享方式**

当进程A要访问某资源是时，必须先提出请求，若此时该资源是空闲的，系统便可以将之分配给进程A使用。此后若在有其他进程对他进行访问，再A进程未结束之前必须进行等待。仅当A进程访问完并释放系统资源后，才允许另一进程对资源进行访问。

把这一段时间内只允许一个进程访问的资源称为临界资源(或独占资源)。系统中大多数物理设备，以及栈，变量和表格都属于临界资源。

#### **同时访问方式**

这里的同时，在单处理机环境下是宏观意义的，而在微观上，这些进程对该资源的访问是交替进行的。典型的可供多个进程“同时”访问的资源就是磁盘设备。

并发和共享是多用户(多任务)OS的两个最基本的特征。它们又是互为存在的条件。资源共享是并行的条件，若系统没有并发就不会存在资源共享，而如果系统没有对资源共享进行有效的管理，也必然影响到并发执行的程度。

- **虚拟**

  在OS中，把通过某种技术把一个物理实体变为若干个逻辑上的对应物的功能称为"虚拟"

  - **时分复用技术**

    时分复用技术提高资源利用率的根本原因在于，他利用某设备为一用户空闲的时间，又转去服务另外的用户，设备得到充分利用。

    - **虚拟处理机技术**

      利用多道程序设计技术，为每一个程序建立至少一个进程，让多道程序并发进行。

    - **虚拟设备技术**

        将一台物理的IO设备虚拟为多台逻辑上的IO设备，并允许每一个用户占用一台逻辑上的IO设备。

  
  - **空分复用技术**
    空分复用技术则是利用存储器的空闲空间分区链存放和运行其他的多道程序，以此来提高效率。
    单纯的空分复用技术只能提升内存的利用率，并不能在逻辑上扩大存储器容量的功能，这还必须引入虚拟存储技术才能达到目的。虚拟存储技术在本质上是对内存的分时复用，即它可以通过分时复用的形式，使一道程序在远小于他的内存空间上运行。
  - **异步**
    每次只允许一个进程执行，其余进程只能等待。

### 操作系统的主要功能

####   处理机管理功能

（

扩展：处理机与`cpu` :

处理机：处理机是计算机系统中存储程序和数据，并按照程序规定的步骤执行指令的部件,包括中央处理器`（cpu）`，主存储器,输入-输出接口   

`cpu` : 是一块超大规模的集成电路，是一台计算机的运算核心（Core）和控制核心（ Control Unit）。它的功能主要是解释计算机指令以及处理计算机软件中的数据.

）

在传统的多道程序系统中，处理机的分配和运行都是以进程为基本单位的，因而对处理机的管理可归结为对进程的管理。处理机管理的主要功能有：创建和撤销进程，对诸进程进行协调，实现进程之间的信息交换，以及按照一定算法把处理机发分配给进程。

- **进程控制**
  在多道程序的环境下为使作业能并发执行，必须为每道作业创建一个或多个进程，当进程运行结束时，还应当立即撤销进程，以便回收此进程占用的各类资源。在设置有线程的OS中，进程控制还应当包括为一个进程创建若干个线程，以提高系统的并发性。
  
- **进程同步**
  为使多个进程有条不紊的运行，系统中必须设置相应的进程同步机制。该机制的主要任务是对多个进程的运行进行协调。协调方式：
  1.进程互斥返回方式。
  2.进程同步方式：指在相互合作去完成共同任务的诸进程间，由同步机构对它们的执行次序加以协调。
  最简单的互斥方式是为每一个临界资源配置一把锁W，当锁打开时，进程可以对该临界资源进行访问，当锁关上时禁止进程访问临界资源。
  最常用的机制是信号量机制。
  
- **进程通信**
  当相互合作的进程处于同一计算机系统时，通常在它们之间采用直接通信方式，即由源进程利用发送命令的直接将消息挂在目标进程的消息队列上，以后由目标进程利用接受命令从消息队列中取出消息。
  
- **调度**
  在传统OS中，调度包括作业调度和进程调度两步
  (1)作业调度：(高级调度)
  作业调度的基本任务就是从后备队列中按照一定的算法选择出若干个作业，为他们分配所需的资源，在将在这些作业调入内存后，分别为他们建立进程，使他们都成为可能获得处理机的就绪进程，并将他们插入就绪队列中去。
  
  (2)内存调度：(中级调度)
  
  引入中级调度是为了提高内存利用率和系统吞吐量。为此， 应使那些暂时不能运行的进程，调至外存等待，把此时的进程状态称为挂起状态 。当它们己具备运行条件且内存又稍有空闲时，由中级调度来决定，把外存上的那些己具备运行条件的就绪进程， 再重新调入内存，并修改其状态为就绪状态 ，挂在就绪队列上等待
  
  (3)进程调度：(低级调度)
  进程调度的任务是从进程就绪队列中按照一定的算法选出一个进程，将处理机分配给他，并未他设置运行现场，使其投入执行。
  
  ![avatar](/home/ls/桌面/class/studyMore/操作系统/img/9300974-62f9a0da7697dfbe.png)



　#### 存储器管理功能

存储管理器应具有内存分配，回收，内存保护，地址映射和内存扩充等功能．

- 内存分配

  (1)为每一道程序分配内存空间，

  (2)提高存储器的利用效率，尽量减少不可用的内存空间(碎片)

  (3)允许正在运行运行的程序申请附加内存，以适应程序和数据动态增长的需要

- 内存分配的两种方式

  - 静态内存分配方式：即每个作业在作业装入是内存空间是确定的，在作业装入之后的整个运行后的期间不允许程序继续申请新的内存空间，也不允许作业在内存空间中＂移动＂.
  - 动态内存分配方式：即虽然每个作业在作业装入的时候内存空间是确定的，但作业在运行过程中申请新的内存空间，也允许作业在内存中移动．

- 内存保护

　　内存保护的主要的任务：

​         (1)确保用户的每道程序都在自己的内存空间中运行，彼此之间互不干扰．

　　(2)决不允许用户程序访问操作系统的程序和数据，也不允许用户程序转移到非共享的其他用户程序中执行.

- 内存保护机制

  一种比较简单的方式就是设置两个界限寄存器，分别用于放在正在执行的程序的上界和下界．系统须对每条指令进行检查所访问的地址，若发生越界，便发出越界中断请求，已停止该程序运行．

- 地址映射

  在程序编译的过程中，其地址都是从０开始的，但是在真正的实际情况中，所有的地址不可能都是从０开始的，所以应当存在将程序的逻辑地址转化为预支相对应的物理地址．该功能应当在硬件支持下完成．

- 内存扩充

  内存扩充是使用虚拟技术使逻辑上内存得到扩充，而实际物理的内存并没有变化．

  - 内存扩充机制
    - 请求调入功能：系统允许在仅装入部分用户程序和数据的情况下，便能对程序进行运行，在运行过程中，若发现需要的数据和程序微装入内存中，可向OS发送请求，有OS将所需的程序和数据由磁盘调入内存中，以便后续需要．
    - 置换功能：即在调入所需的程序和数据是发现内存已满，此时可以将内存中部分暂时不用的的程序和数据放到硬盘中，腾出空间，以调入所需的程序和数据．

#### 设备管理功能

- 缓冲管理

  在I/O设备和CPU之间引入缓冲

  1. **可以有效的缓和I/O设备和CPU速度不匹配的矛盾,**

  2. **提高I/O 和CPU之间得并行 **:   

     CPU快速的将输出的数据写入到缓存区中，I/O设备可以根据自己的速度将数据写入到硬盘中，但是对于CPU而言，它的工作已将完成．可以进行其他的工作．

  　3.**解决处理单位与传输单位不一致问题**:

  ​        对与块设备而言，它的数据传输的单位必然是固定单位的数据块，比如一个扇区，但是对于进程而言，往往是以字节的形式进行读取．

  　　设备将块区域的数据读取到缓冲区，然后在以字节数的形式进行读取

  常见的缓冲机制：

  1.单缓冲机制，

  2.双缓冲机制，能实现双向同时传送数据，

  3.公用缓冲池机制，能供多个设备同时使用

  ![avatar](/home/ls/桌面/class/studyMore/操作系统/img/v2-2790da58b18f5f277540f4a35fae20ef_hd.jpg)

  

- 设备分配

  设备分配的基本任务就是根据用户进程的I/O请求，系统现有的资源情况以及按照某种设备分配策略，为其分配设备．若在I/O设备和CPU之间还存在这设备控制器和I/O通道，则还需为分配出去的设备分配相应的控制器和通道．系统中还应当设置设备控制表，控制器控制表的数据结构进行相关状态的记录，以实现系统的分配.在设备使用完后，应立即由系统回收．

- 设备处理: 又称为设备驱动程序,基本任务：实现CPU和设备控制器之间的通信，即由CPU向设备控制器发送I/O命令，启动I/O设备完成指定的I/O操作，反之，由CPU接受从控制器来的终端请求，并给予迅速的响应和相应的处理．

- I/O控制方式:

  - 　程序I/O方式　：即在处理机向控制器发出一条I/O指令启动输入设备输入数据时，要同时把状态寄存器中的忙/闲标志busy设置为1，然后便不断地循环测试busy，只有当其为0时，表示输入已经送入控制器的数据寄存器中，于是处理机将数据寄存器中的数据取出，送入内存指定单元中，这样便完成了一个字（符）的.
  - 　中断驱动I/O方式　：　当进程中的程序有I/O要求时，CPU会发信号通知相应的设备控制器，然后在继续返回执行相应任务．任务控制器接受信号之后，按要求控制指定的设备，待设备将数据写入寄存器后，由任务控制器进行请求通知CPU，CPU检查输入中是否有错，若没错，就将数据写入内存中．
  
  - 直接存储器访问`（DMA）I/O`控制方式１．数据传输的基本单位是数据块，即在CPU与I/O设备之间，每次传送至少一个数据块。２．所传送的数据是从设备直接送入内存的，或者相反。３．仅在传送一个或多个数据块的开始和结束时，需要CPU干预，整块数据的传送是在控制器的控制下完成的。
  
- `DMA`控制器由三部分组成，主机与`DMA`控制器的接口；`DMA`控制器与块设备的接口；I/O控制逻辑
  

![](/home/ls/桌面/class/studyMore/操作系统/img/616953-20160628173514952-543939858.png)

- １．２两种方式是以字节的方式就是从缓冲区进行读取的，一字节，一字节的进行，而块设备是以块为单位，CPU中断的频率高，３方法则直接以块单位进行
  

下面是三种不同方式的流程图：

![avatar](/home/ls/桌面/class/studyMore/操作系统/img/616953-20160628193955531-1354950266.png)



#### 文件管理功能

- 文件存储空间的管理
  
  为每个文件分配必要的外存空间，提高外存的利用率，进而提高文件系统的存，取速度．
  
  应此系统中应设置相应的数据结构，用来存储文件存储空间的使用情况
  
  还应具有对存储空间进行分配和回收的功能
  
- 目录管理
  
  目录管理还应当实现文件共享，只需要在外存上保留一份该共享文件的副本．
  
  提供快速的目录查询手段，以提高对文件检索的速度．
  
- 文件的读/写管理和保护
  
  (1)文件的读写管理：在进行文件读/写时，系统先根据用户给出的文件名进行检索文件目录，从未获取在外存中的位置．然后利用文件读/写指针进行读/写，完成读/写之后修改读/写指针,为下一次读/写做好准备.
  
  (2)文件保护:
  
  1.防止未经核准的用户存取文件
  
  2.防止冒名的用户存取文件
  
  3.防止以不正确的方式使用文件
  

  
### 操作系统与用户之间的接口

#### 用户接口

- 连接用户接口：为联机用户提供，有一组键盘操作命令即，命令解释程序组成．当用户在终端或控制台上键入一行命令之后，系统便转入命令解释程序，该该命令加以解释及执行．完成指令后系统返回终端或控制台．
  

  
- 脱机用户接口：也称批处理用户接口．即用户可以用作业控制语言`JCL`把需要对作业进行的控制和干预的命令事先写在说明书上，然后将他与作业一起提供给系统．当系统调度到该作业时，通过调用命令解释程序去对作业说明书上的命令逐条解释，直至遇到系统结束语时停止执行．

- 图形用户接口

#### 程序接口

程序接口是为了用户的程序能够访问到系统资源而设置的，是用户程序取得操作系统服务的唯一途径．



### 现代操作系统的新功能

#### 系统安全

- 认证技术：　用来确认用户的真实性．防止入侵者进行假冒和篡改
- 密码技术：　即系统中所需储存的数据和传输的数据进行加密．
- 访问控制技术：　
  - 通过用户存取权限的设置，可以限定用户只能访问被允许访问的资源＼
  - 通过文件属性的设置　，　比如设置文件对于其他用户为可读
- 反病毒技术：对于病毒的威胁就好的方法就是预防．

#### 网络的功能和服务

- 网络通信: 用在源主机和目标主机上面，实现无差错的数据传输．
- 资源管理：即对网络中的共享资源(硬件与软件)实施有效的管理，协调用户使用，保证数据的安全和一致性.
- 应用互操作：即在一个由若干个不同网络互联所构成的互联网络中，必须提供应用互操作功能，以实现信息的互通性和互用性.

#### 支持多媒体

- 接纳控制功能
- 实时调度
- 多媒体文件的存储



### OS结构设计

#### 传统操作系统结构

我们把早期的无结构的OS(第一代),模块化结构的(第二代), 分层式结构的(第三代) 都统称为传统结构的OS，而把微内核结构的OS称为现代结构的OS

- 无结构的操作系统 :早期的操作系统主要有一个人进行编写，注意力放在功能的实现和获得高的效率，致使操作系统内部既复杂又混乱．
- 模块结构OS:  
  - 模块化的基本概念 : 每个模块具有某方面的功能，并仔细规定好每个模块之间的接口，使每个模块之间能通过接口实现交互．
  - 模块独立性: 以下两个标准：
    - 内聚性: 模块内各部分联系的紧密程度，内聚性越高，模块独立性越强．
    - 耦合性：指模块间相互联系和互相影响的程度，耦合度越低，独立性越强．
  - 模块接口法的优缺点
    - 优点：
      - 提高OS设计的正确性，可理解性和可维护性
      - 增强OS的可适应性
      - 加速OS的开发过程
    - 缺点:
      - 对各模块的接口规定很难满足模块完成后的实际需求
      - 设计者必须做出一系列的决定，每一个决定必须建立在上一个的决定之上．
- 分城市结构OS
  - 基本概念：采用自底向上来铺设中间层
  - 优缺点：
    - 优点：
      - 易保证系统的正确性
      - 易扩充和易维护
    - 缺点
      - 系统效率降低

#### 客户/服务器模式简介

- 客户/服务器模式的由来,组成和类型
  - 客户/服务器系统主要由三部分组成
    - 客户机：平视它处理一些本地服务，也可以发行一个消息给服务器，以请求某型服务
    - 服务器：通常是一台规模较大的机器，在其上驻留有网络文件或数据库系统．
    - 网络系统：是用来连接所有客户机和服务器的，实现他们之间的通信和网络资源共享的系统
- 客户/服务器之间的交互
  - 客户发送请求信息：
  - 服务器接受信息：
  - 服务器回送信息
  - 客户机接受信息
- 客户/服务器模式的优点
  - 数据的分布式处理和存储
  - 便于集中管理
  - 灵活性和可扩展性
  - 易于改编应用软件
- 缺点
  - 不可靠性和瓶颈问题

####　微内核结构

- 基本概念: 为了提高操作系统的"正确性","灵活性","易维护性"和"可扩充性",大多采用的是基于客户/服务器模式的微内核

  - 足够小的内核

    微内核并非一个完整的内核，而是内核中最基本的部分，通常包含:

    - 与硬件紧密相连的部分
    - 一些较为基本的功能
    - 客户和服务器之间的通信

  - 基于客户/服务器模式:即将操作系统中的绝大多数的功能放在微内核外面的一组服务器(进程)中实现.相当于在本地跑服务，微内核通过请求相关的进程实现．

    - 优点:
      - 1.就是易于维护，相比于宏内核而言，微内核只需更新自己相关的模块即可完成OS的更新
      - 2.就是只有一个模块出现问题而不至于整个模块死掉，相比宏内核．
    - 缺点:
      - 1.进程间的通信需要时间和资源

  - 应用"机制与策略分离"原理

  - 采用面向对象的技术

- 微内核的基本功能

  - 进程(线程)的管理:由于采用的＂机制与策略分离＂，所以机制一般放在内核中，而策略被放在服务器上.进程通信，切换，线程调度，以及多处理器之间的同步登功能也被放在为内核中
  - 低级存储器管理
  - 中断和陷入处理：因为微内核将机制与策略分离，所以在此时微内核主要任务是捕获所有发生的中断的陷入事件．并进行相应的前期处理.　例如：进行中断现场保护，识别中断和陷入类型，然后将有关时间的信息转化为消息后，把他发给相关的服务器．由服务器进行后期的处理.

- 优点

  - 提高系统的可扩展性
  - 增强系统的可靠性
  - 可移植性强:适应和不同的硬件，应为大多数的服务是跑在服务器上的，所以与硬件无关
  - 提供了分布式系统的支持
  - 融入面向对象技术

- 缺点

  - 请求时更多的上下文切换

    - 原来的OS一般只需要进行两个上下文的切换，一次在执行系统调用后由用户态转为系统态，另一次是在系统完成用户请求的服务后，由系统态返回用户态
    - 在微内核中，由于客户机和服务器，服务器和服务器之间都是需要经过微内核,所以同样的请求至少需要四次上下文切换.

    ![](/home/ls/桌面/class/studyMore/操作系统/img/1427277-20190617222855861-909778725.png)