# Linux

## **Linux文件权与目录管理**

改变文件的属性和权限

- chgrp 改变文件所属的用户组
- chown 改变文件所有者
- chmod 改变文件的权限

**chgrp:**  是change group的简称 ， 使用方法直接chgrp即可 ，但值得注意的是，所改变的组名必须是在etc/group中的文件才行，不然会报错误。

```
# chgrp [-R] dirname/filename  ...
```



**chown:** 是change owner的简称 ,注意的是用户必须是系统的账号，也就是只有在etc/passwd

这个文件中有记录的用户名称才能改变。

-R 可以改变连目录下的所有子目录或文件同时更改文件所有者

```
# chown [-R]  账号名称   文件名称
```



**chmod:** 

Linux的基本权限有9个，分别是ower ， group ， others 三种身份各有自己的read  ， write ， execute 权限,

**数字类型改变权限**

个权限所对应的数字为:

r : 4                                 代表read

w : 2                                代表write

x : 1                                  代表execute

每种身份各自的三种权限是相互累加的， 使用是相应的三种身份所对应的权限值应当给出来。对应下面的xyz，

-R也是递归到目录下面的所有的文件

```
# chmod [-R]   xyz  文件名/目录
```



**符号类型改变**

u (代表user)

g (代表group)                                   +  (加入）                                                   r

o(代表others)                                   -  (除去)                                                      w                                             文件或目录

a(代表all)                                           = (设置)                                                        x                                                     

栗子

```
# chmod  u=rwx , go=rx     xxx
```



**文件种类和扩展名**

文件种类:

- 普通文件：一般为 -

- 纯文本文件： 这是Linux系统中最常见的一种文件。之所以为纯文本文件是因为内容为我们可以直接读取的数据。可以直接执行cat 命令就可以看到其中的内容。

- 二进制文件：

- 数据格式文件：那些特殊格式的文件就可以被称为数据文件。

  栗子：当我们进行系统登录的时候，都会讲登录的信息记录在var/log/wtmp那个文件内，这是一格data file。一般使用last进行读取 ， 用cat 会出现乱码，因为他是属于特殊的格式的文件

  

- 目录：第一个的属性为[d]

- 连接文件：类似与windows里面的快捷方式

- 设备与设备文件：主要分为 块设备文件  和字符设备文件  。   设备文件主要是系统外设和存储的文件。

  块设备文件主要是一些存储数据，提供系统随机访问的接口设备。例如：硬盘 ， 软盘等（属性为[b])

  字符设备文件主要是提供一些串行端口的接口。例如，键盘，鼠标等。     (属性为[c])

- 套接字:  被称为数据接口文件，通常用为网络上的数据连接。属性为[s]

- 管道(FIFO , pipe)

  FIFO也是一个特殊类型的文件，主要用于当多个程序同是访问一个文件的错误情况。  属性为[p]

  

文件目录分为四种类型：

1.可分享 ： 可以分享给其他系统挂载的目录， 包括执行文件和用户数据等

2.不可分享 ： 自己机器上运行的设备文件或者与程序有关的socket文件

3.可变:经常改变的文件 ， 如登录数据等

4.不变：数据不会相应的变动的文件

 

/（root根目录) , 与开机系统有关

根目录是十分的关键的 ，首先他与系统的启动，还原 ， 系统回复有着关系。在用户的角度看待根目录，那就是相当于系统的管理员。但是站在文件的角度进行看待则是一切目录的衍生。根据FHS规则，root目录不用太大因为太大放的东西多了后，结构就会变得很复杂。这样不仅性能较好，而且在文件系统中不会容易出错。

/usr（Unix software resource)  : 与软件的安装执行有关

/var   与系统的运行过程有关

/etc  配置文件

/bin  重要执行文件

/dev   所需的设备文件

/lib    执行文件所需的函数库和内核所需的模块

/sbin  需要的系统执行文件



## 文件与目录管理

#### 文件目录相关操作

比较特殊的目录:

.           代表当前的目录

..          代表上一级的目录

` -`          代表前一个工作目录(返回上一次操作的目录)

~            代表当前用户的主文件夹

~account                  代表用户为account的主文件夹

常见的处理目录命令:

cd          切换目录

pwd      显示当前的目录(路径)

mkdir    新建一个目录

rmdir     删除一个空的目录

~            代表当前用户的主文件夹

~account                  代表用户为account的主文件夹



#### 文件与目录管理

查看文件目录： ls

参数讲解:

-a             全部的文件,连同隐藏文件一列出

-A              列出全部文件 ， 包括隐藏文件 ，但不包括 .  与  ..这两个文件

-d             仅列出文件目录本身,而不是列出目录内的文件数据

-f               直接列出结果,而不进行排序(ls 默认会以文件名排序)

-F             根据文件，目录等信息给予附加数据结构,例如:  *:代表可执行文件     /：代表目录   =:代表socket文件    |:代表FIFO文件

-h             将文件以易读的方式列出

-i               列出inode号码 ，

-l               列出长数据串，包括文件的属性以及权限等数据。

-n             列出UID与GID ， 而非用户与用户组的名称

-r              将排序结果反向输出

-R              连同子目录一同输出，

-S              以文件容量排序，

-t               以时间排序

--color=never        不要依据文件特性给予颜色显示

--color=always       显示颜色

--color=auto            让系统自行依据设置来判断是否给予颜色

--full-time                 以完整时间模式输出

--time={atime ， ctime}    输出访问时间或改变权限属性时间，而非内容改变时间



#### 复制，删除与移动

cp                   复制文件(copy)   cp除了可以用来复制之外，还可以用来创建文件连接方式 , 对比两文件新旧予更新,以及复制整个目录。

复制文件时特别要注意的是权限问题

```
-a                  相当于-pdr的意思
-d                  若源文件为连接文件的属性，则复制连接文件得属性，而非文件本身
-f                   为强制复制的意思，若目标文件已经存在且无法开启，则删除在尝试一次
-i                    若目标文件存在在覆盖是会先询问操作的进行。
-l                    进行硬连接的连接文件进行创建，而非复制文件本身。
-p                  连同文件属性一同复制，而非默认复制
-r                   递归持续复制，用于目录的复制
-s                   复制成为符号链接文件，即快捷方式文件
-u                  若destination比source旧才更新destination
```

mv                 移动文件，还可以使用来进行文件的重命名     在Linux中可以使用remove来进行大量的重命名操作

rm                 删除文件

```
-f                  就是force的意思,忽略文件的不存在
-i                  互动模式,在删除前会询问用户是否操作
-r                  递归删除，最常用的删除了
```



#### 取得路径的文件名和目录名称

basename

```
ls@ls-X542URR:~$ basename ~
ls
//取得的就是文件名
```



dirname 

```
ls@ls-X542URR:~$ dirname ~
/home
//取得的就是文件的路径
```





#### 文件内容查阅

cat  ：                   由第一行开始显示文件内容

tac  ：                    从最后一行开始显示

nl    ：                    显示的时候，顺便输出行号

more  ：               一页一页的显示文件内容

less      :                 与more类似，但是比more更好的是，他可以往前翻

head   :                  只看头几行

tail      ：               只看结尾几行

od       ：               以二进制的方式读取文件的内容

touch  :                 修改文件时间和创建新文件

一般文件有三个描述的时间

mtime：

当该文件的"内容数据"更改时，就是更新此时间。内容数据指的是文件的内容，而并非文件的属性与权限

ctime:

当文件的"状态"改变时，就会更新这个时间。比如文件的属性和权限改变就会改变这个时间。我们在进行复制时，复制了所有的属性，也没有办法复制这个属性。

atime:

当"该文件的内容被取用的时候"，就会更新这个读取时间。

```
-a                           仅仅修改访问的时间
-c                           仅修改文件的时间，若文件不存在就不创建新文件
-d                          后面可以接欲修改的日期而不用目前的日期，也可以使用--date=""
-m                        仅修改mtime
-t                           后面可以接欲修改的时间而不用当前的时间，格式为[YYMMDDHHmm]
```



#### 文件与目录的默认权限与隐藏权限

文件除了有（r ， w ， x）等属性，目录（d），文件(-)等属性外，还有设置系统的隐藏属性，这部分可使用chattr来设置，而用lsattr来查看，最重要的是属性就是设置其不可修改的特性。让文件的所有者都无法对文件进行修改

**文件默认权限:umask**

umask 指定的就是 "目前用户在新建文件或目录时候的权限默认值"

查看umask的方法一：

```
ls@ls-X542URR:~/桌面/class/studyMore/Linux$ umask
0022

#其中第一位为特殊权限 ， 后三位则与之相关 ，后三位与前面的ls  -al的用户对应。
#umask的用法则是在所有权限中进行想用的减去

#设置方法
$ umask    002
```

方法二：

```
ls@ls-X542URR:~/桌面/class/studyMore/Linux$ umask -S
u=rwx,g=rx,o=rx
```

一般root的umask 为022 ， 一般用户的umask即为002



**文件隐藏属性  chattr    lsattr**

首先强调，下面的命令只能在Ext2/Ext3的文件系统上面生效

- chattr  (设置文件的隐藏属性)

  ```
  chattr [+-=]  [ASacdistu]    文件名或者目录
  ```

  参数:

  `+`           :  增加某一个特殊参数 ， 其他原本参数则不动

  `-`            : 删除某一个特殊的参数 ，其他的原本存在的参数则不动

  `=`           : 仅有后面接的参数

  

  A            : 若你访问此文件是时，他的访问时间为atime 将不会被修改,可避免I/O较慢的机器过度访问磁盘

  S            : 一般文件是异步写入文件的，加上此属性时，你进行任何的修改都会变成同步写入。

  a            : 此属性设置后只能增加数据，二不能进行删除数据，但是只有root才能设置此属性.

  c            : 这个属性设置之后，将自动将此文件进行压缩，在读取的时候进行自动解压，在存储时，将会先进行压缩才会进行存储。

  d           ：当dump程序被执行后，设置此属性将可使该文件(或目录)不会被dump备份。

  i             : 他可以是一个文件"不能删除 ， 不能改名 ， 设置连接也无法写入或添加数据"。对于系统的安全性有很大的帮助，只有root才有权限能够进行设置此属性。

  s            : 如果这个文件被删除 ，那么他将完全从这个硬盘空间中删除。

  u           ：与s相反，文件被删除后，但他任然存在在磁盘空间中，可以是用来找回该文件。

- lsattr

  ```
  # lsattr  [-adR]   文件名或者目录
  
  -a   ： 将隐藏文件的属性也输出
  -d   :   如果是目录的目录的话，仅列出目录本身的属性
  -R   ： 连同子目录一同列出来
  ```



#### 文件的特殊权限

文件的权限除了(r , w , x)外还有其他的特殊权限

- SetUID                                   当s这个标志出现在文件所有者的x权限上时，被称为SetUID

​          简称SUID ， 在描述中的缩写为s，他的基本的限制与功能如下:

​          SUID仅对二进制程序有效，

​         执行者需要对该文件有x权限

​         此权限仅在执行该程序过程中有效

​         执行者将具有该程序所有者权限

```
ls@ls-X542URR:/root$ ls  -al   /usr/bin/passwd
-rwsr-xr-x 1 root root 59640 3月  23  2019 /usr/bin/passwd

#对于账号密码储存在这个地方 ， 而只有root才有权限对其进行读写。因为修改密码的passwd有s权限 ， 所以当用户进行
#执行程序的时候就会获得root的权限进行操作，前提是该用户本身对该程序有可执行的权限
#相当于通过可执行程序暂时提高自己的用户等级
```

此外，SUID仅用在二进制的文件上，不能够用在shell  script上面，因为shell script本身就是将二进制文件进行调用执行的。所以SUID的权限部分还是要看shell script调用进来的程序的设置，而不是shell script本身。当然SUID本身对于目录的设定也是无效的。

- Set GID                            当s这个标志出现在用户组的x的权限上时，被称为Set GID

​        简称SGID，与SUID不同的是，SGID可以针对文件或目录来进行设置。针对文件而言，有以下的作用

​        对二进制程序有用，

​       程序执行这对于该程序而言，需具有x权限

​       执行者在执行过程中将会获得程序用户组的支持

​      与Set UID作用类似

​      当用于目录上而言时,具有以下的功能，

​       用户若对于此目录具有r或x的权限时，才可以进入

​       用户在此目录下的有效的用户组，将会变成木块录下的用户组。

​       若用户组在此目录下具有w的权限，则用户所新创建的文件的用户组与当前的目录的用户组相同。

​       SGID对于项目开发非常重要，因为他涉及到的是用户组的权限问题。

- Sticky Bit 

​          简称SBIT  ， 此特殊权限仅仅对于目录有效，而对于文件无效。以下为对目录的功能。

​          简单描述其功能 ， 当一个用户对于一个目录具有用户组或其他人的身份时，并且该用户对于此目录有w的权限，则就意味着该用户可以对此目录下的文件进行删除，重命名 等工作 ， 如果给该用户加上了SBIT权限后，则该用户在目录下新建的文件或就仅仅只能由他自己或者root用户才能进行删除、移动，等操作。而且他无法删除别人的文件。



**设置SUID SGID SBIT权限**

SUID             4

SGID             2

SBIT              1

才设置时在相应的三个数字之前加上一个对应的数字。例如:

-rwsr-xr-x      ----->                   相对于原来的rwx而言 , 原来的为755 ， 这里设置的是 SUID，所以在755前面加上4，即4755

​        

file : 查看文件类型



#### 命令与文件的查询

- 脚本文件名查询

​         which :  (寻找"执行文件")

​         这个命令是根据PATH这个环境变量所规范的路径去查询"执行文件"的文件名。所以重点在于找出文件名。且后面接的是完整的文件名，若加上 -a参数就会找出所有的同名的文件 ， 而并非第一个。

```
ls@ls-X542URR:~/桌面/class/JS$ which ls
/bin/ls
ls@ls-X542URR:~/桌面/class/JS$ which node
/usr/local/bin/node

ls@ls-X542URR:~/桌面/class/JS$ which -a node
/usr/local/bin/node
/usr/bin/node

```

- 文件名的查找

  find是直接在硬盘中进行查找 ， 他会以递归的形式找到当前目录下指定的文件或目录，如果是当前目录下的目录，则会递归进行全部的查看

  在Linux系统中，会将所有的文件记录在一个数据库文件里面，而where和locate就会以这个数据库文件为准进行相应的查找,但是数据库的默认跟新时间为一天一次 ， 所以有可能你使用命令的时候，你可能依旧能找到你删除的文件，而找不到你已经添加的文件，所以可以使用updatedb进行相应的数据库文件进行更新

   通常find 不很常见 ，因为速度慢!通常我们都是使用whereis 或者是 locate 来检查

   where（寻找特定的文件）

​          -b            只找二进制的文件

​          -m           只找在说明文件manual下的文件

​          -s             只找source源文件

​          -u           查找不在上述三个选项中的特殊文件

  locate ：

```
-i                      ：忽略大小写的差异
-r                      :  后面可以接正则表达式的显示方式
```

find : find可以查找与时间相关的内容 

```
-mtime n  :  n为数字 ， 意义为在n天之前的"一天之内"被更改的文件
-mtime  +n   ： 在n天之后被更改的文件 
-mtime   -n    ： 在n天之前被更改的文件
```

与用户或用户组相关的参数:

```
-uid   n              n为数字 ， 代表用户的ID ， 即UID 
-gid    n
-user name
-group   name
-nouser           :寻找文件的所有者不存在的/etc/passwd中的人
-nogroup       : 
-perm              :用于找出特殊权限的文件
```



 

​          







